<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="fas-v4.css">
    <title>Document</title>
</head>
<body>

    <div id="fas-grid-container--header">
        
        <a href="https://www.{{shop.domain}}/pages/stores"><p id="fas-grid--header-text">Find A Store</p></a>
        <div class="break"></div>
        <div id="fas-grid-container--search">
            <div class="fas-search-container">
                <label for="fas-loc-search" class="fas-store-title select-state center"></label>
                <div id="fas-loc-search-button-wrapper">
                    <div id="fas-loc-search-button-inner"></div>
                    <div id="fas-loc-search-button" class="fas-search-bar-button"></div>
                </div>
                <div>
                    <input id="fas-loc-search" type="text" placeholder="Search By Zip">
                    <div class="popup"><span class="popuptext-zip" id="popup-div"></span></div>
                    <div class="popup"><span class="popuptext-zip" id="popup-zip-div">Enter Zip First</span></div>
                </div>
            </div>
        </div>

    </div>

    <div id="fas-grid-container--main">

        <div id="fas-description" class="cyp-visible">
            <div class="store-logo-container"><img src="https://cdn.shopify.com/s/files/1/1921/1117/files/SD_DA_Logo_With_Signet_No_Furn_300_px.svg?v=1675730107" /></div>
            <p>With a focus on quality furniture crafted for every budget,
            sister-brands Scandinavian Designs & Dania Furniture offer the same
            assortment of contemporary, rustic industrial and mid-century modern
            furnishings.</p>
        </div>
        <div id="fas-about-us" class="cyp-visible">
            <div id="store-locations-container" class="store-locations-container"></div>
            <div id="store-page-modal" class="cyp-hidden"></div>
        </div>

    </div>
    




    <script>
    const data = {
		AZ: {
			name: "Arizona",
			stores: {
				glendale: {
					AddressOne: "7540 West Bell Road",
					Brand: "SD",
					Brand_Name: "Scandinavian Designs",
					City: "Glendale",
					Division: "Dupont",
					Division_Name: "74 - DuPont",
					Domain: "scandinaviandesigns",
					Email: "glendale@scandinaviandesigns.com",
					Handle: "glendale",
					Latitude: 33.639759,
					Longitude: -112.221718,
					Map_Link: "https://www.google.com/maps/place/Scandinavian+Designs/@33.6393987,-112.2230755,17z/data=!4m13!1m7!3m6!1s0x872b683a0b186e1d:0x700a652c06fe876b!2s7540+W+Bell+Rd,+Glendale,+AZ+85308!3b1!8m2!3d33.6399093!4d-112.2217291!3m4!1s0x872b69137d47083b:0x3935b3f77abe708c!8m2!3d33.6397094!4d-112.2217178",
					Name: "Glendale",
					PhoneNumber: "(602) 344-9874",
					State: "AZ",
					State_Name: "Arizona",
					States: "AZ",
					Status: "Active",
					Store: "22 - Glendale"
				},
				mesa: {
					AddressOne: "7540 West Bell Road",
					Brand: "SD",
					Brand_Name: "Scandinavian Designs",
					City: "Mesa",
					Division: "Dupont",
					Division_Name: "74 - DuPont",
					Domain: "scandinaviandesigns",
					Email: "glendale@scandinaviandesigns.com",
					Handle: "mesa",
					Latitude: 33.639759,
					Longitude: -112.221718,
					Map_Link: "https://www.google.com/maps/place/Scandinavian+Designs/@33.6393987,-112.2230755,17z/data=!4m13!1m7!3m6!1s0x872b683a0b186e1d:0x700a652c06fe876b!2s7540+W+Bell+Rd,+Glendale,+AZ+85308!3b1!8m2!3d33.6399093!4d-112.2217291!3m4!1s0x872b69137d47083b:0x3935b3f77abe708c!8m2!3d33.6397094!4d-112.2217178",
					Name: "Mesa",
					PhoneNumber: "(602) 344-9874",
					State: "AZ",
					State_Name: "Arizona",
					States: "AZ",
					Status: "Active",
					Store: "22 - Glendale"
				},
				phoenix: {
					AddressOne: "7540 West Bell Road",
					Brand: "SD",
					Brand_Name: "Scandinavian Designs",
					City: "Phoenix",
					Division: "Dupont",
					Division_Name: "74 - DuPont",
					Domain: "scandinaviandesigns",
					Email: "glendale@scandinaviandesigns.com",
					Handle: "phoenix",
					Latitude: 33.639759,
					Longitude: -112.221718,
					Map_Link: "https://www.google.com/maps/place/Scandinavian+Designs/@33.6393987,-112.2230755,17z/data=!4m13!1m7!3m6!1s0x872b683a0b186e1d:0x700a652c06fe876b!2s7540+W+Bell+Rd,+Glendale,+AZ+85308!3b1!8m2!3d33.6399093!4d-112.2217291!3m4!1s0x872b69137d47083b:0x3935b3f77abe708c!8m2!3d33.6397094!4d-112.2217178",
					Name: "Phoenix",
					PhoneNumber: "(602) 344-9874",
					State: "AZ",
					State_Name: "Arizona",
					States: "AZ",
					Status: "Active",
					Store: "22 - Glendale"
				}
			}
		},
		MI: {
			name: "Michigan",
			stores: {
				qwerty: {
					AddressOne: "7540 West Bell Road",
					Brand: "SD",
					Brand_Name: "Scandinavian Designs",
					City: "Glendale",
					Division: "Dupont",
					Division_Name: "74 - DuPont",
					Domain: "scandinaviandesigns",
					Email: "glendale@scandinaviandesigns.com",
					Handle: "glendale",
					Latitude: 33.639759,
					Longitude: -112.221718,
					Map_Link: "https://www.google.com/maps/place/Scandinavian+Designs/@33.6393987,-112.2230755,17z/data=!4m13!1m7!3m6!1s0x872b683a0b186e1d:0x700a652c06fe876b!2s7540+W+Bell+Rd,+Glendale,+AZ+85308!3b1!8m2!3d33.6399093!4d-112.2217291!3m4!1s0x872b69137d47083b:0x3935b3f77abe708c!8m2!3d33.6397094!4d-112.2217178",
					Name: "Glendale",
					PhoneNumber: "(602) 344-9874",
					State: "AZ",
					State_Name: "Arizona",
					States: "AZ",
					Status: "Active",
					Store: "22 - Glendale"
				},
				dddddd: {
					AddressOne: "7540 West Bell Road",
					Brand: "SD",
					Brand_Name: "Scandinavian Designs",
					City: "Mesa",
					Division: "Dupont",
					Division_Name: "74 - DuPont",
					Domain: "scandinaviandesigns",
					Email: "glendale@scandinaviandesigns.com",
					Handle: "mesa",
					Latitude: 33.639759,
					Longitude: -112.221718,
					Map_Link: "https://www.google.com/maps/place/Scandinavian+Designs/@33.6393987,-112.2230755,17z/data=!4m13!1m7!3m6!1s0x872b683a0b186e1d:0x700a652c06fe876b!2s7540+W+Bell+Rd,+Glendale,+AZ+85308!3b1!8m2!3d33.6399093!4d-112.2217291!3m4!1s0x872b69137d47083b:0x3935b3f77abe708c!8m2!3d33.6397094!4d-112.2217178",
					Name: "Mesa",
					PhoneNumber: "(602) 344-9874",
					State: "AZ",
					State_Name: "Arizona",
					States: "AZ",
					Status: "Active",
					Store: "22 - Glendale"
				},
				asdf: {
					AddressOne: "7540 West Bell Road",
					Brand: "SD",
					Brand_Name: "Scandinavian Designs",
					City: "Phoenix",
					Division: "Dupont",
					Division_Name: "74 - DuPont",
					Domain: "scandinaviandesigns",
					Email: "glendale@scandinaviandesigns.com",
					Handle: "phoenix",
					Latitude: 33.639759,
					Longitude: -112.221718,
					Map_Link: "https://www.google.com/maps/place/Scandinavian+Designs/@33.6393987,-112.2230755,17z/data=!4m13!1m7!3m6!1s0x872b683a0b186e1d:0x700a652c06fe876b!2s7540+W+Bell+Rd,+Glendale,+AZ+85308!3b1!8m2!3d33.6399093!4d-112.2217291!3m4!1s0x872b69137d47083b:0x3935b3f77abe708c!8m2!3d33.6397094!4d-112.2217178",
					Name: "Phoenix",
					PhoneNumber: "(602) 344-9874",
					State: "AZ",
					State_Name: "Arizona",
					States: "AZ",
					Status: "Active",
					Store: "22 - Glendale"
				}
			}
		},
		LO: {
			name: "Made Up State",
			stores: {
				zabba: {
					AddressOne: "7540 West Bell Road",
					Brand: "SD",
					Brand_Name: "Scandinavian Designs",
					City: "Glendale",
					Division: "Dupont",
					Division_Name: "74 - DuPont",
					Domain: "scandinaviandesigns",
					Email: "glendale@scandinaviandesigns.com",
					Handle: "glendale",
					Latitude: 33.639759,
					Longitude: -112.221718,
					Map_Link: "https://www.google.com/maps/place/Scandinavian+Designs/@33.6393987,-112.2230755,17z/data=!4m13!1m7!3m6!1s0x872b683a0b186e1d:0x700a652c06fe876b!2s7540+W+Bell+Rd,+Glendale,+AZ+85308!3b1!8m2!3d33.6399093!4d-112.2217291!3m4!1s0x872b69137d47083b:0x3935b3f77abe708c!8m2!3d33.6397094!4d-112.2217178",
					Name: "Glendale",
					PhoneNumber: "(602) 344-9874",
					State: "AZ",
					State_Name: "Arizona",
					States: "AZ",
					Status: "Active",
					Store: "22 - Glendale"
				},
				abba: {
					AddressOne: "7540 West Bell Road",
					Brand: "SD",
					Brand_Name: "Scandinavian Designs",
					City: "Mesa",
					Division: "Dupont",
					Division_Name: "74 - DuPont",
					Domain: "scandinaviandesigns",
					Email: "glendale@scandinaviandesigns.com",
					Handle: "mesa",
					Latitude: 33.639759,
					Longitude: -112.221718,
					Map_Link: "https://www.google.com/maps/place/Scandinavian+Designs/@33.6393987,-112.2230755,17z/data=!4m13!1m7!3m6!1s0x872b683a0b186e1d:0x700a652c06fe876b!2s7540+W+Bell+Rd,+Glendale,+AZ+85308!3b1!8m2!3d33.6399093!4d-112.2217291!3m4!1s0x872b69137d47083b:0x3935b3f77abe708c!8m2!3d33.6397094!4d-112.2217178",
					Name: "Mesa",
					PhoneNumber: "(602) 344-9874",
					State: "AZ",
					State_Name: "Arizona",
					States: "AZ",
					Status: "Active",
					Store: "22 - Glendale"
				},
				meh: {
					AddressOne: "7540 West Bell Road",
					Brand: "SD",
					Brand_Name: "Scandinavian Designs",
					City: "Phoenix",
					Division: "Dupont",
					Division_Name: "74 - DuPont",
					Domain: "scandinaviandesigns",
					Email: "glendale@scandinaviandesigns.com",
					Handle: "phoenix",
					Latitude: 33.639759,
					Longitude: -112.221718,
					Map_Link: "https://www.google.com/maps/place/Scandinavian+Designs/@33.6393987,-112.2230755,17z/data=!4m13!1m7!3m6!1s0x872b683a0b186e1d:0x700a652c06fe876b!2s7540+W+Bell+Rd,+Glendale,+AZ+85308!3b1!8m2!3d33.6399093!4d-112.2217291!3m4!1s0x872b69137d47083b:0x3935b3f77abe708c!8m2!3d33.6397094!4d-112.2217178",
					Name: "Phoenix",
					PhoneNumber: "(602) 344-9874",
					State: "AZ",
					State_Name: "Arizona",
					States: "AZ",
					Status: "Active",
					Store: "22 - Glendale"
				}
			}
		}
	}

    let stateAbbr = []
	
	const mobileSelector = document.querySelector('#store-state-selector');
	const storePageContainer = document.querySelector('#store-page-modal');
	const storeLocationsContainer = document.querySelector("#store-locations-container");
	const aboutUs = document.querySelector("#fas-about-us");
	//const searchLabel = document.querySelector("#fas-loc-search-label");
	//if(window.innerWidth < 799) searchLabel.innerText = "Select a state or search by zipcode"

	const $popup = document.querySelector('#popup-div');
	const $popupZip = document.querySelector("#popup-zip-div");
	const $searchBarWrapper = document.querySelector('#fas-loc-search-button-wrapper');
	const $searchBarButtonInner = document.querySelector('#fas-loc-search-button-inner');
	const $searchBarButton = document.querySelector('#fas-loc-search-button');
	const $searchBar = document.querySelector('#fas-loc-search');
	
	const currentDate = new Date();
	const currentDateName = currentDate.toLocaleDateString('en-US',{weekday: 'long'}).toLowerCase();
	const currentHour = currentDate.getHours();
	const currentDateFormatted = (currentDate.getMonth() + 1) + "/" + currentDate.getDate();
	const weekdayMap = new Map();
	
	var startOfWeek = new Date();
	//	Decrement until we reach monday, the start of our week (Sunday is 0 index, but we list Monday first)
	while(startOfWeek.toLocaleDateString('en-US',{weekday: 'long'}).toLowerCase() != "monday") {
		startOfWeek.setDate(startOfWeek.getDate() - 1);
	}
	
//	Create a hashmap of the week starting on monday that will be used to get regular or holiday hours for the week
//	Key: {weekdayName, e.g. "monday"}
//	Value: {Javascript Date}
	dateIncrementer = new Date(startOfWeek);
	for(var i = 0; i < 7; i++) {
		weekdayMap.set(dateIncrementer.toLocaleDateString('en-US',{weekday: 'long'}).toLowerCase(), new Date(dateIncrementer));
		dateIncrementer.setDate(dateIncrementer.getDate() + 1);
	}
	
	var $url = new URL(document.URL);
	const stateQueryParam = String($url.searchParams.get("state"));
	const storeQueryParam = String($url.searchParams.get("store"));
	
	var stores = {};
	var activeStateContainer;
	var activeStores = [];
	var activeState;
	var transitionLock = false;
	var firstPass = true;
	
	const INSUFFICIENT_ZIP_ERROR = "Please enter 5 characters, leading with zeros if necessary";
	const MALFORMED_ZIP_ERROR = "Invalid zipcode";
	
	const timer = ms => new Promise(res => setTimeout(res, ms));
	
	$searchBar.focus();
	setTimeout(function(){ $searchBar.selectionStart = $searchBar.selectionEnd = 6; }, 0);
	
	// fetch("https://sdecommerceapi.azurewebsites.net/getStoreList")
	// 	.then(response => response.json())
	// 	.then(storeList => {
	// 		stores = storeList;
	//         if(storeList.hasOwnProperty(stateQueryParam) && storeList[stateQueryParam].stores.hasOwnProperty(storeQueryParam)) {
	//     	//	If the URL already has a valid query, present that store	
	//     		buildStorePage();
	// 		}
	//         buildInfrastructure(stores)
	// 	});

    buildStateInterface(data)

    function buildStateInterface(data) {
	// set and build state container
	    for(const stateCode in data) {
	        const state = data[stateCode];
	        const stateDiv = document.createElement('div')
	        const stateContainerMarkup = `
	            <div id="state-container-${stateCode}" class="state-container cyp-hidden" state="${stateCode}">
	                <h2 class="state-header">${state.name}</h2>
	                <div class="break"></div>
	            </div>`
	            
	        stateDiv.classList.add('center-hotfix')
	        stateDiv.innerHTML = stateContainerMarkup;
	        document.querySelector('#store-locations-container').append(stateDiv)
			
			const storeList = state.stores;
			var storeHandles = Object.keys(storeList);
			storeHandles.sort();
			
	        // set and build each store location
	        for(const storeHandle of storeHandles) {
	        	const store = storeList[storeHandle];
	            const storeCardProfile = document.createElement('div')
	            storeCardProfile.classList.add('card-store-profile', 'fas-item')
	            storeCardProfile.setAttribute("handle", store.Handle);
	            	
	            storeCardProfile.innerHTML = assembleStoreCardHtml(store);
	            
	            document.querySelector(`#state-container-${stateCode}`).append(storeCardProfile)
	        }
	    }
	
	//	Build the custom search page
	//	Note that no store cards are built - they will be built and removed upon each search
		const stateDiv = document.createElement('div')
	    const stateContainerMarkup = `
	    	<div id="state-container-search" class="state-container cyp-hidden" state="search">
	             <h2 id="search-container-header" class="state-header"></h2>
	             <div class="break"></div>
	        </div>`
	    
	    stateDiv.classList.add('center-hotfix')
	    stateDiv.innerHTML = stateContainerMarkup;
	    document.querySelector('#store-locations-container').append(stateDiv)
	
	    if(stateQueryParam && data.hasOwnProperty(stateQueryParam)){
	    //	If state is present in URL and API response, set it as the current state
			activeStateContainer = document.querySelector(`#state-container-${stateQueryParam}`);
			activeState = document.querySelector(`#${stateQueryParam}`);
	   		activeState.classList.add("state-selected");

	   		if(!(data[stateQueryParam].stores.hasOwnProperty(storeQueryParam))) {
	   			revealStores();
	   		}
		}
	}
	

    function assembleStoreCardHtml (store, storeDistance) {
	
    var storeDistanceHtml = "";
    if(storeDistance != null){
        storeDistanceHtml = `<p><i>Approx</i>. <b>${storeDistance}</b> miles away</p>`;
    }

    var phone = `<p class="store-phone" phoneLink="tel:${store.PhoneNumber}">${store.PhoneNumber}</p>`;
      if(store["Closed Reason"] != null) {
        phone = "<p>" + store["Closed Reason"] + "</p>";
    }
    const storeCardMarkup = `
        <div class="fas-store-card">
            <div class="fas-store-card-textcontainer">
                <div class="fas-store-card-title">
                    <p class="store-title">${store.Name}</p>
                </div>
                <div class="fas-store-card-address">
                    ${storeDistanceHtml}
                    <p class="store-address">
                        ${store.AddressOne}
                    </p>
                    <p class="store-address2">
                        ${store.City}, ${store.State} ${store.Zip}
                    </p>
                </div>
                <div class="fas-store-card-phone">
                    ${phone}
                </div>
            </div>
        </div>`
    
        return storeCardMarkup;
    }

    </script>
</body>
</html>